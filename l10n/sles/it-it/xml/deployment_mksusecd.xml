<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_mksusecd.xml" version="5.0" role="General" xml:id="cha-deployment-prep-mksusecd">
 <title>Personalizzazione delle immagini di installazione con mksusecd</title>
 <info>
  <abstract>
   <para>
    <command>mksusecd</command> è uno strumento utile per creare un&apos;immagine di installazione personalizzata. Utilizzarlo per modificare le normali immagini di installazione di SUSE Linux Enterprise, aggiungere e rimuovere file, creare un&apos;immagine di installazione di rete minima, personalizzare le opzioni di avvio e i repository software e creare un&apos;immagine di avvio minima come alternativa all&apos;avvio di un sistema da un server PXE.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec-deployment-install-mksusecd">
  <title>Installazione di mksusecd</title>

  <para>
   In SLE 15, <command>mksusecd</command> si trova nel modulo <literal>Development
   Tools</literal>. Se tale modulo non è abilitato, è necessario prima abilitarlo. Trovare il nome esatto del modulo e il comando di attivazione <command>SUSEConnect</command> con <command>zypper</command>:
  </para>

<screen><prompt>&gt; </prompt>zypper search-packages mksusecd
Following packages were found in following modules:

Package              Module or Repository
-------------------- -------------------------------------------------------------------
---------------------- -----------------------------------------------------------------
mksusecd             Development Tools Module (sle-module-development-tools/15.4/x86_64)
                       SUSEConnect --product sle-module-development-tools/15.4/x86_64

To activate the respective module or product, use SUSEConnect --product.
Use SUSEConnect --help for more details.</screen>

  <para>
   Abilitare il modulo con SUSEConnect:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> SUSEConnect --product sle-module-development-tools/15.4/x86_64</screen>

  <para>
   Installare <command>mksusecd</command>:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> zypper in mksusecd</screen>

  <para>
   Eseguire <command>mksusecd --help</command> per visualizzare un elenco completo di comandi.
  </para>

  <para>
   Dopo aver creato l&apos;immagine personalizzata, masterizzarla su un CD/DVD utilizzando un programma di scrittura su disco oppure creare un&apos;unità flash USB di avvio mediante il comando <command>dd</command>. Accertarsi che il dispositivo non sia montato, quindi eseguire il comando:
  </para>

<screen><prompt role="root"># </prompt><command>dd</command> if=<replaceable>myinstaller.iso</replaceable> of=/dev/<replaceable>SDB</replaceable> bs=4M</screen>

  <para>
   Il nuovo dispositivo di avvio è pronto per l&apos;uso.
  </para>
 </sect1>
 <sect1 xml:id="sec-deployment-prep-boot-mksusecd">
  <title>Creazione di un&apos;immagine di avvio minima</title>

  <para>
   Utilizzare <command>mksusecd</command> per creare un&apos;immagine di avvio minima per l&apos;avvio dei computer client da un CD/DVD o un&apos;unità flash USB, anziché da un server di avvio PXE. L&apos;immagine minima esegue l&apos;avvio del kernel e di initrd, quindi i file di installazione rimanenti vengono recuperati da un server NFS locale (consultare la <xref linkend="sec-deployment-instserver-sles9"/>).
  </para>

  <para>
   Eseguire il comando seguente per creare l&apos;immagine ISO minima:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> <command>mksusecd</command> --create <replaceable>min-install.iso</replaceable> \
--net=nfs://<replaceable>192.168.1.1:/srv/install/</replaceable><replaceable>ARCH</replaceable>/<replaceable>OS_VERSION</replaceable>/<replaceable>SP_VERSION</replaceable>/cd1  \
/srv/tftpboot/EFI/<replaceable>ARCH</replaceable>/boot</screen>

  <para>
   Sostituire l&apos;indirizzo del server NFS con il proprio. Sostituire <replaceable>ARCH</replaceable> con la directory corrispondente nell&apos;architettura del sistema di destinazione. Sostituire anche <replaceable>OS_version</replaceable> e <replaceable>SP_VERSION</replaceable> (service pack) in base ai propri percorsi in <xref linkend="sec-deployment-instserver-sles9"/>.
  </para>



  


 </sect1>

 <sect1 xml:id="sec-deployment-custom-image-boot">
  <title>Impostazione dei parametri di avvio del kernel predefiniti</title>

  <para>
   Anziché attendere un prompt di avvio per accedere ai parametri di avvio del kernel, configurarli in un&apos;immagine <command>mksusecd</command> personalizzata:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>install.iso</replaceable> \
--boot "<replaceable>textmode=1 splash=silent mitigations=auto</replaceable>"</screen>

  <para>
   Verificare che i parametri personalizzati vengano caricati correttamente dopo l&apos;avvio eseguendo una query su <filename>/proc</filename>:
  </para>

<screen><prompt>&gt; </prompt>cat /proc/cmdline</screen>
 </sect1>
 <sect1 xml:id="sec-deployment-custom-modules">
  <title>Personalizzazione di moduli, estensioni e repository</title>

  <para>
   SUSE Linux Enterprise 15 supporta moduli (da non confondere con i moduli kernel) ed estensioni per vari componenti di prodotti. Si tratta di componenti aggiuntivi del <literal>Basesystem</literal> di default, ad esempio <literal>Development
   Tools</literal>, <literal>Desktop Applications</literal> e <literal>Live Patching</literal> di SUSE Linux Enterprise. Per ulteriori informazioni, consultare la guida Modules and Extensions Quick Start (Riferimento rapido per moduli ed estensioni).
  </para>

  <para>
   Con <command>mksusecd</command> è possibile creare un&apos;immagine di installazione contenente tutti i moduli e le estensioni aggiuntivi desiderati. Per iniziare, eseguire una query sulle immagini esistenti, come in questo esempio per SUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase>:
  </para>

  <screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --list-repos SLE-15-SP6-Full-<replaceable>ARCH</replaceable>-GM-media1.iso
Repositories:
  Basesystem-Module [15.6-0]
  SUSE-CAP-Tools-Module [15.6-0]
  Containers-Module [15.6-0]
  Desktop-Applications-Module [15.6-0]
  Development-Tools-Module [15.6-0]
  HPC-Module [15.6-0]
  Legacy-Module [15.6-0]
  Live-Patching [15.6-0]
  Public-Cloud-Module [15.6-0]
  Python2-Module [15.6-0]
  SAP-Applications-Module [15.6-0]
  Server-Applications-Module [15.6-0]
  Transactional-Server-Module [15.6-0]
  Web-Scripting-Module [15.6-0]
  SLEHA15-SP6 [15.6-0]
  SLE-15-SP6-HPC [15.6-0]
  SLED15-SP6 [15.6-0]
  SLES15-SP6 [15.6-0]
  SLE-15-SP6-SAP [15.6-0]
  SLEWE15-SP6 [15.6-0]
  [...]
</screen>

  <para>
   Creare una nuova immagine di installazione basata sui moduli, sulle estensioni e sui repository selezionati ed eseguirne l&apos;abilitazione automatica:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>myinstaller.iso</replaceable> --enable-repos auto \
--include-repos <replaceable>Basesystem-Module,Desktop-Applications-Module</replaceable> \
SLE-15-SP6-Full-<replaceable>ARCH</replaceable>-GM-media1.iso</screen>

  <para>
   Questo esempio crea un&apos;immagine per l&apos;installazione da Internet. Per creare un&apos;immagine per l&apos;installazione offline, aggiungere anche il repository del prodotto di base, ad esempio <literal>SLES15-SP6</literal> per SUSE Linux Enterprise Server.
  </para>

  <screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>myinstaller.iso</replaceable> --enable-repos auto \
   --include-repos <replaceable>SLES15-SP6,Basesystem-Module,Desktop-Applications-Module</replaceable> \
   SLE-15-SP6-Full-<replaceable>ARCH</replaceable>-GM-media1.iso</screen>

  <para>
   Per fare in modo che il programma di installazione mostri una finestra di dialogo per la selezione dei moduli, sostituire <option>--enable-repos auto</option> con <option>--enable-repos ask</option>.
  </para>

  <note>
   <title>file di controllo di AutoYaST</title>
   <para>
    Quando si utilizza l&apos;opzione <option>--enable-repos</option>, <command>mksusecd</command> aggiunge alla nuova immagine un file <filename>add_on_products.xml</filename> da utilizzare con AutoYaST. I moduli inclusi in questo file non devono essere elencati nel file di controllo di AutoYaST.
   </para>
  </note>
 </sect1>
 <sect1 xml:id="sec-deployment-custom-netinstall">
  <title>Creazione di un&apos;immagine ISO di installazione di rete minima</title>

  <para>
   Per creare un&apos;immagine di installazione minima per l&apos;avvio di un&apos;installazione di rete, utilizzare l&apos;opzione <command>--nano</command>:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>netinstall.iso</replaceable> \
--nano SLE-15-SP6-Online-<replaceable>ARCH</replaceable>-GM-media1.iso</screen>
 </sect1>
 <sect1 xml:id="sec-deployment-custom-repo">
  <title>Modificare il repository predefinito</title>

  <para>
   Per impostare un repository diverso, ad esempio un repository locale, utilizzare l&apos;opzione <command>--net</command>:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>localinstall.iso</replaceable> \
--net "https://example.com/local" SLE-15-SP6-Online-<replaceable>ARCH</replaceable>-GM-media1.iso</screen>
 </sect1>
</chapter>

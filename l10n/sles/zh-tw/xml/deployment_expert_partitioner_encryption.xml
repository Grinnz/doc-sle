<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_expert_partitioner_encryption.xml" version="5.0" xml:id="deployment-encryption" os="sles;sled;osuse">
  <title>裝置加密</title>

  <info>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:bugtracker/>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
  </info>

  <para>
    Linux Unified Key Setup (LUKS) 是 Linux 磁碟加密的標準。它提供了標準化的磁碟格式，讓使用者能夠無縫傳輸或移轉資料。
  </para>
  <para>
    LUKS 用於加密區塊裝置。加密裝置的內容可以是任意內容，因此它可以加密任何檔案系統，包括交換分割區。包括加密金鑰和參數在內的所有必要設定資訊 (如加密類型和金鑰大小) 都儲存在分割區標頭中。
  </para>
  <para>
    系統採用多層方法來完成加密。首先，使用主要金鑰加密區塊裝置。然後，使用每個有效的使用者金鑰加密此主要金鑰。使用者金鑰取自密碼片語、FIDO2 安全金鑰、TPM 或智慧卡。採用這種多層方法，使用者無需重新加密整個區塊裝置，即可變更其密碼片語。
  </para>
  <para>
    如需 LUKS 的詳細資訊，請參閱<xref linkend="cha-configure-cryptctl"/>。
  </para>

  <sect2 xml:id="deployment-encryption-methods">
    <title>加密方法</title>
    <para>
      若要加密裝置，請依照<xref linkend="sec-expert-partitioner-options"/>中的說明操作。
    </para>
    <tip>
      <title>在 YaST 中啟用 LUKS2 支援</title>
      <para>
        從 SUSE Linux Enterprise 15 SP4 開始，YaST 磁碟分割程式支援 LUKS2 加密，但需要明確啟用該功能。完成該作業的方法有兩種︰
      </para>
      <orderedlist>
        <listitem>
          <para>
            在開機時，將 <literal>YAST_LUKS2_AVAILABLE</literal> 的參數新增至核心指令列。如需開機參數的資訊，請參閱<xref linkend="cha-boot-parameters"/>。
          </para>
        </listitem>
        <listitem>
          <para>
            安裝期間，在 YaST 組態中：
          </para>
          <itemizedlist>
            <listitem>
              <para>
                在圖形介面中，按 <keycombo><keycap>Ctrl</keycap><keycap>Alt</keycap>
                  <keycap>Shift</keycap><keycap>C</keycap></keycombo> 鍵。
              </para>
            </listitem>
            <listitem>
              <para>
                在文字介面中，按 <keycombo><keycap>Ctrl</keycap><keycap>D</keycap></keycombo> 鍵，然後按 <keycombo><keycap>Shift</keycap><keycap>C</keycap></keycombo> 鍵。
              </para>
            </listitem>
          </itemizedlist>
          <para>
            檢查 <literal>Enable Experimental LUKS2 Encryption Support</literal> 並按一下 <literal>OK</literal> 離開組態畫面。
          </para>
        </listitem>
      </orderedlist>
    </tip>
    <para>
      如果您未啟用 LUKS2 支援，則<guimenu>加密方法</guimenu>選項不會顯示，您只需輸入加密密碼即可。
    </para>
    <variablelist xml:id="vl-encryption-methods">
      <varlistentry>
        <term><guimenu>一般 LUKS1</guimenu></term>
        <listitem>
          <para>
            此方法允許使用 LUKS1 加密裝置。您必須提供加密密碼。稍後可以使用 <command>cryptsetup luksAddKey</command> 新增更多密碼 (最多共 8 個)。
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><guimenu>一般 LUKS2</guimenu></term>
        <listitem>
          <para>
            LUKS2 使用較新版本的標頭格式，該格式具有抗損毀能力，並支援多達 32 個使用者金鑰和裝置標籤。您必須提供加密密碼和以密碼為基礎的金鑰衍生函數 (PBKDF)，該函數將用於保護該密碼片語 (請參閱<xref linkend="deployment-encryption-pbkdf"/>)。
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><guimenu>普遍 LUKS2</guimenu> (僅限在 IBM Z 上)</term>
        <listitem>
          <para>
            此方法允許透過 LUKS2 加密裝置，加密時使用由 Crypto Express 加密副處理器在 CCA 模式下處理得到的主要安全金鑰。如果加密系統中已經有一個與此磁碟區關聯的安全金鑰，則使用該金鑰。否則，將產生一個新的安全金鑰，並將其註冊到系統中。您需要提供一個用來保護該主要金鑰的加密密碼。此外，當系統中存在多個 APQN 時，您可以選擇要使用哪一個。
          </para>
          <para>
            如需普遍加密的詳細資訊，請參閱 <link xlink:href="https://www.ibm.com/docs/en/linux-on-systems?topic=security-pervasive-encryption"/>。
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><guimenu>使用可變隨機金鑰加密</guimenu> (僅適用於交換裝置)</term>
        <listitem>
          <para>
            此方法使用系統開機時隨機產生的金鑰來加密交換裝置，因此不支援休眠到硬碟。每次開機時都會重新加密交換裝置，並會損毀裝置中之前的內容。為避免資料遺失，請停用休眠功能，改為將系統設定為關機。
          </para>
          <para>
            除了加密金鑰之外，每次重新加密交換裝置後，裝置標籤和 UUID 都會變更，因此您不應當透過指定裝置標籤和 UUID 來掛接隨機加密的交換裝置。請確定該交換裝置在 <filename>/etc/crypttab</filename> 檔案中使用了穩定的名稱，且該名稱不會在每次系統重新開機時變更。例如，對於交換分割區，更安全的做法是使用 udev 裝置 ID 或者路徑，而不是分割區的裝置名稱，因為該裝置名稱在下次開機時可能會指定給其他分割區。如果出現這樣的情況，就會加密錯誤的裝置，而不是您的交換裝置！
          </para>
          <para>
            YaST 會嘗試在 <filename>/etc/crypttab</filename> 中使用穩定的名稱，除非其設定為一律使用裝置名稱 (請參閱磁碟分割程式的<guimenu>設定</guimenu>區段)。但是，對於某些裝置，可能無法找到完全穩定的名稱。請僅在您完全瞭解上述隨機加密方法可能產生的影響後，才可使用可變金鑰進行加密。
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><guimenu>受保護的交換</guimenu> (僅適用於交換裝置)</term>
        <listitem>
          <para>
            此方法使用可變的受保護 AES 金鑰加密交換裝置，而無需加密副處理器。這是對<literal>Encryption with
              Volatile Random Key</literal>方法的改進，該方法的所有注意事項仍然適用。
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><guimenu>安全交換</guimenu> (僅適用於交換裝置)</term>
        <listitem>
          <para>
            此方法使用加密副處理器產生的可變安全 AES 金鑰加密交換裝置。這是對<literal>Encryption with
              Volatile Random Key</literal>方法的改進，該方法的所有注意事項仍然適用。
          </para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect2>

  <sect2 xml:id="deployment-encryption-pbkdf">
    <title>以密碼為基礎的金鑰衍生函數</title>
    <para>
      應使用哪個以密碼為基礎的金鑰衍生函數 (PBKDF)，取決於使用情境、硬體能力以及需要與其他系統元件相容的程度：
    </para>
    <variablelist xml:id="vl-pbkdf">
      <varlistentry>
        <term>PBKDF2</term>
        <listitem>
          <para>
            LUKS1 所使用的函數為 <literal>PBKDF2</literal>，其定義請參閱 <link xlink:href="https://tools.ietf.org/html/rfc2898">RFC 2898</link>。
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Argon2i</term>
        <listitem>
          <para>
            Argon2 函數更安全，但需要大量記憶體用於運算。其定義請參閱 <link xlink:href="https://tools.ietf.org/html/rfc9106">RFC 9106</link>。Argon2i 是 Argon2 最佳化後的變體，透過以與密碼無關的順序存取記憶體陣列來抵禦旁路攻擊。
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Argon2id</term>
        <listitem>
          <para>
            Argon2id 是 Argon2 的混合版本。它在前半段記憶體傳遞中遵循 Argon2i 方法，在後續傳遞中遵循 Argon2d (YaST 不支援) 方法，以限制 GPU 破解攻擊。如果您不知道這些類型之間的差別，或者您認為有可能會遭到旁路攻擊，RFC 9106 建議使用 Argon2id。
          </para>
        </listitem>
      </varlistentry>
    </variablelist>
    <para>
      雖然 <literal>Argon2</literal> 更安全，但有些情形下仍需使用 <literal>PBKDF2</literal>：
    </para>
    <itemizedlist>
      <listitem>
        <para>
          做為一項有意設計的安全性功能，Argon2 需要更多的記憶體用於運算。這可能會導致某些系統出現問題。如果可以完全保證密碼的強度，那麼使用 PBKDF2 可能仍然是安全的，而且可以節省記憶體。
        </para>
      </listitem>
      <listitem>
        <para>
          <systemitem>grub2</systemitem> 對於從使用 LUKS2 加密的裝置開機提供有限的支援，但前提是所用的加密方法為 PBKDF2。這表示您不能對包含 <filename>/boot</filename> 目錄的檔案系統使用 Argon2。請注意，即使使用了 PBKDF2，也可能需要以手動方式進行一些 <systemitem>grub2</systemitem> 組態才能從 LUKS2 裝置開機。
        </para>
      </listitem>
    </itemizedlist>
    
    <para>
      如需使用 LUKS 設定裝置加密的詳細資訊，請使用安裝程式中的 <literal>Help</literal> 按鈕以及參閱<xref linkend="cha-configure-cryptctl"/>。
    </para>
  </sect2>
</sect1>

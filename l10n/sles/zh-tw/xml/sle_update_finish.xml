<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_finish.xml" version="5.0" xml:id="cha-upgrade-finish">
 <title>完成升級</title>
 <info>
  <abstract>
   <para>
    升級後，您需要執行一些額外的任務。本章將引導您完成這些步驟。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <sect1 xml:id="sec-upgrade-finish-old-packages">
  <title>檢查舊套件</title>
  <para>
   使用 <command>zypper packages</command> 檢查孤立的和不需要的套件。
  </para>
  <para>
   孤立的套件在任何已設定的套件儲存庫中都不再提供。這些套件不再會更新且不再受支援。
  </para>
  <para>
   若要查看孤立的套件清單，請執行：
  </para>
<screen><prompt>&gt; </prompt><command>zypper packages --orphaned</command></screen>
  <para>
   不需要的套件是以下套件的相依項：使用者已明確安裝或者已隨模式或產品隱式安裝，但同時又被移除。系統通常不再需要這些相依項，因此也應將其移除。
  </para>
  <para>
   若要查看不需要的套件清單，請執行：
  </para>
<screen><prompt>&gt; </prompt><command>zypper packages --unneeded</command></screen>
  <tip>
   <para>
    為避免出現不需要的套件，請將 <command>zypper rm</command> 與 <option>--clean-deps</option> 選項配合使用，或在使用 YaST 時啟用<menuchoice>
     <guimenu>選項</guimenu><guimenu>刪除套件時清理</guimenu></menuchoice>。
   </para>
  </tip>
  <para>
   可以將兩個清單合併為一個：
  </para>
<screen><prompt>&gt; </prompt><command>zypper packages --orphaned --unneeded</command></screen>
  <para>
   使用這些清單可以確定仍然需要哪些套件，以及可以移除哪些套件而不會產生問題。
  </para>
  <warning>
   <title>請勿移除您需要的套件</title>
   <para>
    如果套件已重新命名或從模式或產品中移除，<command>zypper</command> 可能不再將它們視為已明確安裝，並會將其標示為不需要，即使它們仍然對您的安裝至關重要也是如此。
   </para>
   <para>
    請仔細檢查您所要移除套件的清單。
   </para>
  </warning>
  <para>
   若要使用單個指令移除所有孤立的和不需要的套件，請執行：
  </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper rm $(zypper --no-refresh packages --orphaned --unneeded | gawk '{print $5}' | tail -n +5)</command></screen>
  <para>
   排除要解除安裝的單個套件或模式：
  </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper rm $(zypper --no-refresh packages --orphaned --unneeded | gawk '{print $5}' | tail -n +5 | grep -v <replaceable>PACKAGE_TO_EXCLUDE</replaceable>)</command></screen>
  <para>
   排除文字檔案中定義的多個套件 (透過換行字元分隔)：
  </para>
  <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper rm $(zypper --no-refresh packages --orphaned --unneeded | gawk '{print $5}' | tail -n +5 | grep -v -f <replaceable>/PACKAGES/TO/KEEP.txt</replaceable>)</command></screen>
 </sect1>
 <sect1 xml:id="sec-uggrade-finish-config-files">
  <title>檢閱組態檔案</title>
  <para>
   檢查所有 <filename>*.rpmnew</filename> 和 <filename>*.rpmsave</filename> 檔案。如果升級項目包括對某個預設組態檔案所做的變更，而該檔案在安裝套件後已改變，則系統不會覆寫該檔案，而是建立這些檔案類型中的一個。<filename>*.rpmnew</filename> 包含新的預設組態並將已改變的檔案保持不變，而 <filename>*.rpmsave</filename> 是已改變的組態 (現已由新的預設檔案取代) 的副本。
  </para>
  <para>
   如果您找到這些檔案中的任何一個，請檢查其內容並合併所需的變更。無需搜尋整個檔案系統，而只需搜尋 <filename>/etc</filename> 目錄。使用以下指令：
  </para>
<screen><prompt>&gt; </prompt><command>find /etc/ -name "*.rpmnew" -o -name "*.rpmsave"</command></screen>
 </sect1>

 
 <sect1 xml:id="sec-upgrade-finish-python3">
  <title>啟用 <literal>Python 3</literal> 模組</title>
  <para>
   <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 15 預設會使用 Python 3.6。<phrase role="productname"><phrase os="sles">SLES</phrase></phrase> 15 SP3 中新增了更新的版本 Python 3.9 來替代 Python 3.6。自 <phrase role="productname"><phrase os="sles">SLES</phrase></phrase> 15 SP4 起，不再支援此版本，而是透過 <literal>Python 3</literal> 模組來提供包含重要更新和安全性修復的最新 Python 版本。
  </para>
  <para>
   如果您在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 15 SP 下安裝了 3.9，請使用以下指令來啟用 <literal>Python 3</literal> 模組：
  </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>SUSEConnect -p sle-module-python3/15.6/<replaceable>x86_64</replaceable></command>&#x002E;</screen>
  <para>
   或者，您也可以使用 <command>zypper remove -u python39</command> 移除 3.9 版本，以恢復為預設的 Python 版本。
  </para>
 </sect1>

 <sect1 xml:id="sec-upgrade-finish-xfs4">
  <title>重新設定 XFS v4 裝置的格式</title>
  <para>
   <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 支援 XFS 檔案系統的<quote>磁碟上格式</quote> (v5)。這種格式的主要優點包括，自動獲取所有 XFS 中繼資料的檢查總數、檔案類型支援以及支援檔案更多數量的存取控制清單。
  </para>
  <para>
   請注意，以下元件不支援此格式：低於 3.12 版的 SUSE Linux Enterprise 核心、低於 3.2.0 版的 <literal>xfsprogs</literal>，以及在 SUSE Linux Enterprise 12 之前發佈的 GRUB 2 版本。
  </para>
  <important>
   <title>V4 將棄用</title>
   <para>
    XFS 即將棄用採用 V4 格式的檔案系統。此檔案系統格式是由以下指令建立：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> mkfs.xfs -m crc=0 <replaceable>DEVICE</replaceable></screen>
   <para>
    該格式用於 SLE 11 及更早版本中，現在此格式會導致 <command>dmesg</command> 發出警告訊息：
   </para>
<screen>Deprecated V4 format (crc=0) will not be supported after September 2030</screen>
   <para>
    如果您在 <command>dmesg</command> 指令的輸出中看到上述訊息，建議將檔案系統更新至 V5 格式：
   </para>
   <procedure>
    <step>
     <para>
      將資料備份至另一部裝置。
     </para>
    </step>
    <step>
     <para>
      在該裝置上建立檔案系統。
     </para>
<screen><prompt>&gt; </prompt><command>sudo</command> mkfs.xfs -m crc=1 <replaceable>DEVICE</replaceable></screen>
    </step>
    <step>
     <para>
      在更新後的裝置上使用備份還原資料。
     </para>
    </step>
   </procedure>
  </important>
 </sect1>
</chapter>

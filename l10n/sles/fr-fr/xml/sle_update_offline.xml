<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_offline.xml" version="5.0" xml:id="cha-upgrade-offline">
 <title>Mise à niveau en mode hors ligne</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    Ce chapitre décrit la procédure de mise à niveau d&apos;une installation SUSE Linux Enterprise existante à l&apos;aide de YaST, qui est démarré à partir d&apos;un support d&apos;installation. Le programme d&apos;installation de YaST peut, par exemple, être démarré à partir d&apos;un DVD, du réseau ou du disque dur qui héberge le système.
   </para>
  </abstract>
 </info>
 <sect1 xml:id="sec-upgrade-offline-conceptual-overview">
  <title>Présentation conceptuelle</title>
  <para>
   Avant d&apos;entamer la mise à niveau de votre système, consultez le <xref linkend="cha-update-preparation"/>.
  </para>
  <para>
   Pour mettre à niveau votre système, démarrez à partir d&apos;une source d&apos;installation, comme vous le feriez pour une nouvelle installation. Toutefois, lorsque l&apos;écran de démarrage apparaît, vous devez sélectionner <guimenu>Mettre à niveau</guimenu> (au lieu d&apos;<guimenu>Installation</guimenu>). La mise à niveau peut être démarrée à partir des éléments suivants :
  </para>

  <itemizedlist>
   <listitem>
    <formalpara>
     <title>Supports amovibles</title>
     <para>
      Il peut notamment s&apos;agir d&apos;un CD, d&apos;un DVD ou d&apos;un périphérique de stockage de masse USB. Pour plus d&apos;informations, reportez-vous à la <xref linkend="sec-upgrade-offline-dvd"/>.
     </para>
    </formalpara>
   </listitem>
   <listitem>
    <formalpara>
     <title>Ressource réseau</title>
     <para>
      Vous pouvez démarrer à partir d&apos;un support local, puis sélectionner le type d&apos;installation réseau respectif ou démarrez via PXE. Pour plus d&apos;informations, reportez-vous à la <xref linkend="sec-upgrade-offline-network"/>.
     </para>
    </formalpara>
   </listitem>
  </itemizedlist>
 </sect1>


 <sect1 xml:id="sec-upgrade-offline-dvd">
  <title>Démarrage de la mise à niveau à partir d&apos;un support d&apos;installation</title>
  
  <para>
   La procédure ci-dessous décrit le démarrage à partir d&apos;un DVD, mais vous pouvez également utiliser un support d&apos;installation local comme une image ISO sur un périphérique de stockage de masse USB. Le support et la méthode de démarrage à sélectionner dépendent de l&apos;architecture système et du fait que la machine dispose d&apos;un BIOS traditionnel ou UEFI.
  </para>
  <procedure xml:id="pro-update-sle12-offline-dvd">
   <title>mise à niveau manuelle vers <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase></title>
   <step>
    <para>
     Sélectionnez et préparez un support de démarrage (voir <xref linkend="part-prep"/>).
    </para>
   </step>
   <step>
    <para>
     Insérez le DVD du programme d&apos;installation unifié pour <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase> et démarrez votre machine. L&apos;écran <guimenu>Bienvenue</guimenu> s&apos;affiche, suivi de l&apos;écran de démarrage.
    </para>
   </step>
   <step performance="optional">
    <para>
     Pour forcer le programme d&apos;installation à installer uniquement les paquetages à partir du DVD et non à partir de sources réseau, ajoutez l&apos;option de démarrage <option>media_upgrade=1</option>.
    </para>
   </step>
   <step>
    <para>
     Démarrez le système en sélectionnant <emphasis>Mise à niveau</emphasis> dans le menu de démarrage.
    </para>
   </step>
   <step>
    <para>
     Effectuez la procédure de mise à niveau, comme décrit à la <xref linkend="sec-upgrade-offline-yast"/>.
    </para>
   </step>
  </procedure>
 </sect1>

 <sect1 xml:id="sec-upgrade-offline-network">
  <title>Démarrage de la mise à niveau à partir d&apos;une source réseau</title>
  <para>
   Pour démarrer une mise à niveau à partir d&apos;une source d&apos;installation réseau, veillez à respecter les conditions suivantes :
  </para>
  <variablelist>
   <title>Configuration requise pour la mise à niveau à partir d&apos;une source d&apos;installation réseau</title>
   <varlistentry>
    <term>Source d&apos;installation réseau</term>
    <listitem>
     <para>
      Une source d&apos;installation réseau est configurée conformément au <xref linkend="cha-deployment-instserver"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Connexion réseau et services réseau</term>
    <listitem>
     <para>
      Le serveur d&apos;installation et la machine cible doivent disposer d&apos;une connexion réseau qui fonctionne. Les services réseau requis sont les suivants :
     </para>
     <itemizedlist>
      <listitem><para>Service de noms de domaines</para></listitem>
      <listitem><para>DHCP (uniquement nécessaire pour un lancement via PXE ; l&apos;adresse IP peut être définie manuellement lors de la configuration)</para></listitem>
      <listitem><para>OpenSLP (facultatif)</para></listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Support de démarrage</term>
    <listitem>
     <para>
      Un DVD de démarrage SUSE Linux Enterprise, une image ISO ou une installation PXE opérationnelle. Pour plus d&apos;informations sur le démarrage via PXE, reportez-vous au <xref linkend="sec-deployment-prep-boot-pxeprep"/>. Reportez-vous au <xref linkend="cha-remote-installation"/> pour obtenir des informations détaillées sur le démarrage d&apos;une mise à niveau à partir d&apos;un serveur distant.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <sect2 xml:id="sec-update-sle-manual-network-boot-from-dvd">
   <title>Mise à niveau manuelle via une source d&apos;installation réseau - démarrage à partir d&apos;un DVD</title>
  
   <para>
    Cette procédure fournit l&apos;exemple d&apos;un démarrage à partir d&apos;un DVD, mais vous pouvez également utiliser tout autre support d&apos;installation local comme une image ISO sur un périphérique de stockage de masse USB. La façon de sélectionner la méthode de démarrage et de démarrer le système à partir du support dépend de l&apos;architecture système. Vous devez également savoir si la machine est équipée d&apos;un BIOS ou UEFI traditionnel. Pour plus de détails, reportez-vous aux liens ci-dessous.
   </para>

   <procedure xml:id="pro-update-sle-manual-network-boot-from-dvd">

    <step>
     <para>
      Insérez le DVD du programme d&apos;installation unifié pour <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase> et démarrez votre machine. L&apos;écran <guimenu>Bienvenue</guimenu> s&apos;affiche, suivi de l&apos;écran de démarrage.
     </para>
    </step>
    <step>
     <para>
      Sélectionnez le type de source d&apos;installation réseau que vous souhaitez utiliser (FTP, HTTP, NFS, SMB ou SLP). En général, ce choix est disponible en appuyant sur la touche <keycap>F4</keycap>, mais si votre machine est équipée d&apos;UEFI au lieu d&apos;un BIOS traditionnel, vous devrez peut-être adapter manuellement les paramètres de démarrage. Pour plus d&apos;informations, reportez-vous au <xref linkend="cha-boot-parameters"/> et au <xref linkend="cha-install"/>.
     </para>
    </step>
    <step>
     <para>
      Effectuez la procédure de mise à niveau, comme décrit à la <xref linkend="sec-upgrade-offline-yast"/>.
     </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec-update-sle-manual-network-pxe-boot">
   <title>Mise à niveau manuelle via une source d&apos;installation réseau - démarrage à partir de PXE</title>
   <para>
    Pour effectuer une mise à niveau à partir d&apos;une source d&apos;installation réseau à l&apos;aide d&apos;un démarrage PXE, procédez comme suit :
   </para>
   <procedure xml:id="pro-update-sle-manual-network-pxe-boot">
    <step>
     <para>
      Ajustez la configuration de votre serveur DHCP afin de fournir les informations relatives à l&apos;adresse indispensables à un démarrage à l&apos;aide de PXE. Pour plus de détails, reportez-vous au <xref linkend="pro-deployment-dhcp-server"/>.
     </para>
    </step>
    <step>
     <para>
      Configurez un serveur TFTP qui devra contenir l&apos;image de démarrage requise pour un démarrage à l&apos;aide de PXE. Pour ce faire, utilisez le DVD du programme d&apos;installation pour <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase> ou suivez les instructions du <xref linkend="sec-deployment-tftp-server"/>.
     </para>
    </step>
    <step>
     <para>
      Préparez le démarrage de PXE et de Wake-on-LAN sur l&apos;ordinateur cible.
     </para>
    </step>
    <step>
     <para>
      Lancez le démarrage du système cible et utilisez VNC pour vous connecter à distance à la routine d&apos;installation s&apos;exécutant sur cet ordinateur. Pour plus d&apos;informations, reportez-vous au <xref linkend="sec-remote-installation-monitor-vnc"/>.
     </para>
    </step>
    <step>
     <para>
      Effectuez la procédure de mise à niveau, comme décrit à la <xref linkend="sec-upgrade-offline-yast"/>.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>

 <sect1 xml:id="sec-upgrade-offline-yast">
  <title>Mise à niveau de SUSE Linux Enterprise</title>
  <para>
   <remark>taroth 2014-11-13: argh, the following is terminology hell regarding
     the software strings: "upgrade"/"update" are used intermittently and
     without clear differentiation...</remark>
  </para>
  <para>
   Avant de mettre à niveau votre système, lisez d&apos;abord le <xref linkend="cha-update-preparation"/>. Pour effectuer une migration automatisée, procédez comme suit :
  </para>
  <procedure>
   <note>
    <title>SUSE Customer Center et connexion Internet</title>
    <para>
     Si le système que vous souhaitez mettre à niveau est enregistré auprès de SUSE Customer Center, assurez-vous de disposer d&apos;une connexion Internet lors de la procédure suivante.
    </para>
   </note>
   <step>
    <para>
     Après avoir démarré (à partir d&apos;un support d&apos;installation ou du réseau), sélectionnez l&apos;entrée <guimenu>Mise à niveau</guimenu> dans l&apos;écran de démarrage.
    </para>
    <warning>
     <title>un choix erroné risque de vous faire perdre des données</title>
     <para>
      Vérifiez que vous avez bien sélectionné l&apos;option <guimenu>Mise à niveau</guimenu> à ce stade. Si vous sélectionnez <guimenu>Installation</guimenu> par erreur, votre partition de données sera écrasée par une nouvelle installation.
     </para>
    </warning>
    <para>
     YaST démarre le système d&apos;installation.
    </para>
   </step>
   <step>
    <para>
     Sur l&apos;écran de <guimenu>bienvenue</guimenu>, choisissez <guimenu>Langue</guimenu> et <guimenu>Clavier</guimenu>. Cliquez ensuite sur <guimenu>Suivant</guimenu>.
    </para>
    <para>
     YaST recherche dans vos partitions les systèmes SUSE Linux Enterprise déjà installés.
    </para>
   </step>
   <step>
    <para>
     Dans l&apos;écran <guimenu>Sélectionner pour la mise à niveau</guimenu>, sélectionnez la partition à mettre à niveau et cliquez sur <guimenu>Suivant</guimenu>.
    </para>
   </step>
   <step>
    <para>
     YaST monte la partition sélectionnée et affiche le contrat de licence du produit mis à niveau. Pour continuer, acceptez la licence.
    </para>
   </step>
   <step>
    <para>
     Dans l&apos;écran <guimenu>Dépôts utilisés précédemment</guimenu>, ajustez l&apos;état des dépôts. Par défaut, tous les dépôts sont supprimés. Si vous n&apos;avez ajouté aucun dépôt personnalisé, ne modifiez pas les paramètres. Les paquetages de la mise à niveau seront installés à partir du DVD. Vous pouvez éventuellement activer les dépôts en ligne par défaut à l&apos;étape suivante.
    </para>
    <para>
     Si vous possédez des dépôts personnalisés, deux options s&apos;offrent à vous :
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Laissez le dépôt à l&apos;état Supprimé. Les logiciels installés à partir de ce dépôt seront supprimés au cours de la mise à niveau. Utilisez cette méthode si aucune version du dépôt correspondant à la nouvelle version n&apos;est disponible.
      </para>
     </listitem>
     <listitem>
      <para>
       Mettez à jour et activez le dépôt s&apos;il correspond à la nouvelle version. Changez l&apos;URL en cliquant sur le dépôt dans la liste, puis cliquez sur <guimenu>Modifier</guimenu>. Activez le dépôt en cochant la case <guimenu>Changer l&apos;état</guimenu> jusqu&apos;à ce qu&apos;il soit défini sur <guimenu>Activer</guimenu>.
      </para>
     </listitem>
    </itemizedlist>
    <para>
     Ne conservez pas de dépôts de la version précédente, car le système risque d&apos;être instable ou de ne pas fonctionner du tout. Ensuite, continuez en cliquant sur <guimenu>Suivant</guimenu>.
    </para>
   </step>
   <step>
    <para>
     L&apos;étape suivante diffère selon que le système mis à niveau est enregistré ou non auprès de Suse Customer Center.
    </para>
    <substeps>
     <step>
      <para>
       Si le système n&apos;est pas enregistré auprès de Suse Customer Center, YaST affiche une fenêtre contextuelle suggérant d&apos;utiliser un deuxième support d&apos;installation, l&apos;image SLE-15-SP6-Full-<replaceable>ARCH</replaceable>-GM-media1.iso.
      </para>
      <para>
       Si vous ne disposez pas de ce support, le système ne peut pas être mis à niveau sans enregistrement.
      </para>
     </step>
     <step>
      <para>
       Si le système est enregistré auprès de SUSE Customer Center, YaST affiche un résumé et les cibles de migration possibles.
      </para>
      <para>
       Sélectionnez une cible de migration à partir de la liste et cliquez sur <guimenu>Suivant</guimenu>.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Dans la boîte de dialogue suivante, vous pouvez éventuellement ajouter un support d&apos;installation supplémentaire. Si vous possédez d&apos;autres supports d&apos;installation, activez l&apos;option <guimenu>Je souhaite installer un autre produit complémentaire</guimenu> et spécifiez le type de support.
    </para>
   </step>
   <step>
    <para>
     Vérifiez les <guimenu>paramètres d&apos;installation</guimenu> pour la mise à niveau.
    </para>
   </step>
   <step>
    <para>
     Si tous les paramètres vous conviennent, démarrez la procédure d&apos;installation et de suppression en cliquant sur <guimenu>Mettre à jour</guimenu>.
    </para>
    <tip>
     <title>échec de la mise à niveau sur les clients SMT</title>
     <para>
      Si la machine à mettre à niveau est un client SMT et que la mise à niveau échoue, reportez-vous à la <xref linkend="pro-sec-update-prep-smt-de-register"/> et redémarrez la procédure de mise à niveau ultérieurement.
     </para>
    </tip>
   </step>
   <step>
    <para>
     Une fois la mise à niveau réussie, effectuez les vérifications postérieures à la mise à niveau comme décrit au <xref linkend="cha-upgrade-finish"/>.
    </para>
   </step>
  </procedure>
 </sect1>

 <sect1 xml:id="sec-upgrade-offline-automated" os="sles">
  <title>Mise à niveau à l&apos;aide d&apos;AutoYaST</title>
  <para>
   Le processus de mise à niveau peut être exécuté automatiquement. Pour plus de détails, reportez-vous au <xref linkend="CreateProfile-upgrade"/>.
  </para>
 </sect1>

 <sect1 xml:id="sec-upgrade-offline-manager">
  <title>Mise à niveau à l&apos;aide de SUSE Manager</title>
  <para>
   SUSE Manager est une solution serveur pour fournir des mises à jour et des correctifs pour les clients SUSE Linux Enterprise. Il s&apos;accompagne d&apos;un ensemble d&apos;outils et d&apos;une interface utilisateur Web pour les tâches de gestion. Pour plus d&apos;informations sur SUSE Manager, consultez l&apos;adresse <link xlink:href="https://www.suse.com/products/suse-manager/"/>.
  </para>
  <para>
   Vous pouvez effectuer une mise à niveau système à l&apos;aide de SUSE Manager. La technologie AutoYaST permet d&apos;effectuer des mises à niveau d&apos;une version majeure vers la suivante.
  </para>

  <para>
  Si votre machine est gérée par SUSE Manager, mettez ce dernier à jour comme indiqué dans la documentation de SUSE Manager. La procédure <citetitle>Client Migration</citetitle> est décrite dans le <citetitle>SUSE Manager Upgrade Guide</citetitle>, disponible à l&apos;adresse <link xlink:href="https://documentation.suse.com/suma/"/>.
 </para>
 </sect1>
 <sect1 xml:id="sec-update-reg-status-after-rollback">
  <title>Mise à jour de l&apos;état d&apos;enregistrement après un retour à l&apos;état initial</title>

  <para>
   Lorsque vous effectuez la mise à niveau d&apos;un Service Pack, vous devez modifier la configuration sur le serveur d&apos;enregistrement pour donner accès aux nouveaux dépôts. Si le processus de mise à niveau a été interrompu ou annulé (par le biais d&apos;une restauration à partir d&apos;une sauvegarde ou d&apos;un instantané), les informations sur le serveur d&apos;enregistrement ne reflètent pas l&apos;état du système. Dès lors, vous risquez de ne pas avoir accès aux dépôts de mise à jour ou à des dépôts incorrects utilisés sur le client.
  </para>

  <para>
   Lorsqu&apos;un retour à l&apos;état initial est effectué via Snapper, le système avertit le serveur d&apos;enregistrement pour garantir que l&apos;accès aux dépôts appropriés est configuré au cours du processus de démarrage. Si le système a été restauré avec une autre méthode ou que la communication avec le serveur d&apos;enregistrement échoue, déclenchez manuellement le retour à l&apos;état initial sur le client. Cela peut se produire notamment si le serveur n&apos;est pas accessible en raison de problèmes réseau. Pour procéder à un retour à l&apos;état initial, exécutez :
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> <command>snapper</command> rollback</screen>

  <para>
   Nous suggérons de toujours vérifier que les dépôts corrects sont configurés sur le système, en particulier après le rafraîchissement du service à l&apos;aide de la commande:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper</command> ref -s</screen>

  <para>
   Cette fonctionnalité est disponible dans le paquetage <package>rollback-helper</package>.
  </para>
 </sect1>
 <sect1 xml:id="sec-update-registersystem">


  <title>Enregistrement de votre système</title>

  <para>
   Si le système n&apos;était pas enregistré avant l&apos;exécution de la mise à niveau, vous pouvez enregistrer votre système à tout moment à l&apos;aide du module <guimenu>Enregistrement du produit</guimenu> dans YaST.
  </para>

  <para>
   L&apos;enregistrement de vos systèmes vous offre les avantages suivants :
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Vous pouvez bénéficier du support.
    </para>
   </listitem>
   <listitem>
    <para>
     Vous avez accès aux mises à jour de sécurité et aux correctifs de bogues.
    </para>
   </listitem>
   <listitem>
    <para>
     Vous avez accès au SUSE Customer Center.
    </para>
   </listitem>
  </itemizedlist>

  <procedure>
   <step>
    <para>
     Démarrez YaST et sélectionnez <menuchoice> <guimenu>Logiciels</guimenu>
     <guimenu> Enregistrement du produit</guimenu> </menuchoice> pour ouvrir la boîte de dialogue <guimenu>Enregistrement</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Indiquez l&apos;<guimenu>Adresse électronique</guimenu> associée au compte SUSE que vous ou votre entreprise utilisez pour gérer les abonnements. Si vous ne disposez pas encore de compte SUSE, rendez-vous sur la page d&apos;accueil du SUSE Customer Center (<link xlink:show="new" xlink:href="https://scc.suse.com/"/>) pour en créer un.
    </para>
   </step>
   <step>
    <para>
     Entrez le <guimenu>Code d&apos;enregistrement</guimenu> que vous avez reçu avec votre exemplaire de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>.
    </para>
   </step>
   <step>
     <para>
      Si un ou plusieurs serveurs d&apos;enregistrement locaux sont disponibles sur votre réseau, vous pouvez en sélectionner un dans la liste.
     </para>
   </step>
   <step xml:id="st-y2-register-final">
    <para>
     Pour commencer l&apos;enregistrement, poursuivez en sélectionnant <guimenu>Suivant</guimenu>.
    </para>
    <para>
     Une fois l&apos;enregistrement réussi, YaST affiche la liste des extensions, produits complémentaires et modules disponibles pour votre système. Pour les sélectionner et les installer, reportez-vous au <xref linkend="sec-register-sle-add-modules"/>.
    </para>
   </step>
  </procedure>
 </sect1>

</chapter>
